<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>The anatomy of a vanilla JavaScript plugin | Go Make Things</title>
		

		
		<meta name="viewport" content="width=device-width, initial-scale=1">

		
		
		<link rel="shortcut icon" href="https://gomakethings.com/img/favicon.ico">
		<link rel="icon" sizes="16x16 32x32" href="https://gomakethings.com/img/favicon.ico">

		
		
		<link rel="alternate" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">
		<link rel="feed" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">

		
		<link rel="stylesheet" href="https://gomakethings.com/css/main.min.1.1.0.css">

		
		<script src="https://gomakethings.com/js/detects.min.1.1.0.js"></script>
		<script>
			;(function () {
				var css = 'https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i';
				if (getCookie('fontsLoaded')) {
					loadCSS(css);
					document.documentElement.className += 'fonts-loaded';
				} else {
					loadCSS(css);
					var font = new FontFaceObserver('PT Serif');
					font.load().then(function () {
						var expires = new Date(+new Date() + (7 * 24 * 60 * 60 * 1000)).toUTCString();
						document.cookie = 'fontsLoaded=true; expires=' + expires;
						document.documentElement.className += ' fonts-loaded';
					});
				}
			})();
		</script>
	</head>

	<body>

		<div class="container container-large">

	
	<a class="screen-reader screen-reader-focusable" href="#main">Skip to main content</a>

	
	<a class="screen-reader screen-reader-focusable" href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;?subject=Go%20Make%20Things:%20Accessibility%20Feedback">Accessibility Feedback</a>

</div>

		<header class="container container-large margin-bottom-large">
	<nav class="nav-wrap">
		<a class="logo" href="https://gomakethings.com">
			<svg xmlns="http://www.w3.org/2000/svg" style="height:.8em;width:.8em" viewBox="0 0 16 16"><title></title><path fill="currentColor" d="M14 9v2.066c-1.258 1.285-3.016 2.526-5 2.852V8.001h3v-1L9 5.83A3.001 3.001 0 0 0 8 .001 3 3 0 0 0 7 5.83L4 7.001v1h3v5.917c-1.984-.326-3.742-1.567-5-2.852V9H0v1c0 2 4 6 8 6s8-4 8-6V9h-2zM9 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg>
			Go Make Things
		</a>
		<div class="nav-menu" id="nav-menu">
			<ul class="nav">
				<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
			</ul>
		</div>
	</nav>
</header>

		<main id="main" tabindex="-1">

			<div class="container">

	<article>

	
	<h1><span class="title">The anatomy of a vanilla JavaScript plugin</span></h1>
	

	<p>For those of you who are in the process of <a href="/ditching-jquery/">ditching jQuery</a>, I thought it might be helpful to talk through how I structure my <a href="/free-stuff/#interactive-content">native JavaScript plugins</a>.</p>

<p></p>

<h2 id="the-template">The Template</h2>

<p>Here&rsquo;s the template I start all of my projects from. We&rsquo;re going to walk through it step-by-step.</p>

<pre><code class="language-lang-javascript">(function (root, factory) {
	if ( typeof define === 'function' &amp;&amp; define.amd ) {
		define(['buoy'], factory(root));
	} else if ( typeof exports === 'object' ) {
		module.exports = factory(require('buoy'));
	} else {
		root.myPlugin = factory(root, root.buoy);
	}
})(typeof global !== &quot;undefined&quot; ? global : this.window || this.global, function (root) {

	'use strict';

	//
	// Variables
	//

	var myPlugin = {}; // Object for public APIs
	var supports = !!document.querySelector &amp;&amp; !!root.addEventListener; // Feature test
	var settings; // Placeholder variables

	// Default settings
	var defaults = {
		someVar: 123,
		initClass: 'js-myplugin',
		callbackBefore: function () {},
		callbackAfter: function () {}
	};


	//
	// Methods
	//

	// @todo add plugin methods here

	/**
	 * Handle events
	 * @private
	 */
	var eventHandler = function (event) {
		// @todo Do something on event
	};

	/**
	 * Destroy the current initialization.
	 * @public
	 */
	myPlugin.destroy = function () {

		// If plugin isn't already initialized, stop
		if ( !settings ) return;

		// Remove init class for conditional CSS
		document.documentElement.classList.remove( settings.initClass );

		// @todo Undo any other init functions...

		// Remove event listeners
		document.removeEventListener('click', eventHandler, false);

		// Reset variables
		settings = null;

	};

	/**
	 * Initialize Plugin
	 * @public
	 * @param {Object} options User settings
	 */
	myPlugin.init = function ( options ) {

		// feature test
		if ( !supports ) return;

		// Destroy any existing initializations
		myPlugin.destroy();

		// Merge user options with defaults
		settings = buoy.extend( defaults, options || {} );

		// Add class to HTML element to activate conditional CSS
		document.documentElement.classList.add( settings.initClass );

		// @todo Do stuff...

		// Listen for click events
		document.addEventListener('click', eventHandler, false);

	};


	//
	// Public APIs
	//

	return myPlugin;

});
</code></pre>

<h2 id="dependencies">Dependencies</h2>

<p>I include two addtional files with most of my projects. The <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/classList#wrapper">classList.js polyfill</a> extends classList support back to IE8 (natively, it&rsquo;s IE10+). <a href="https://github.com/cferdinandi/buoy">Buoy</a> is a tiny collection of helper methods taht I use in most of my scripts.</p>

<h2 id="umd-wrapper">UMD Wrapper</h2>

<p>I use a <a href="https://github.com/umdjs/umd">Universal Module Definition (UMD) wrapper</a> for all of my plugins. This wrapper means that my scripts are compatibile with both AMD and CommonJS, and also work as a traditional module pattern.</p>

<p>It also creates scope around the plugin, preventing variables and functions from being added to the global scope or being overridden by similarly named variables in other scripts.</p>

<pre><code class="language-lang-javascript">(function (root, factory) {
	if ( typeof define === 'function' &amp;&amp; define.amd ) {
		define(['buoy'], factory(root));
	} else if ( typeof exports === 'object' ) {
		module.exports = factory(require('buoy'));
	} else {
		root.myPlugin = factory(root, root.buoy);
	}
})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {

	// Plugin stuff...

});
</code></pre>

<p>This sets up the namespacing for your plugin. You should change <code>myPlugin</code> to the name of your plugin.</p>

<p>Any references to <code>buoy</code> pass in my helper library as a dependency. In a browser, <code>root</code> is the <code>window</code>. This line addresses a Browserify bug that doesn&rsquo;t pass in <code>root</code> as <code>window</code> like it&rsquo;s supposed to.</p>

<pre><code class="language-lang-javascript">typeof global !== 'undefined' ? global : this.window
</code></pre>

<h2 id="use-strict"><code>use strict</code></h2>

<p><code>use strict</code> tells the browser (and JS linting tools) to be more strict about the errors that they throw. This sounds like a bad thing, but if forces you to write better, more cross-compatibile code. Always use it.</p>

<h2 id="variables">Variables</h2>

<p>At the top of my plugin, I setup the variables I&rsquo;m going to be using throughout. This keeps everything neatly organized and in one place, and makes it easier to access variables without having to specifically pass them in to methods later.</p>

<pre><code class="language-lang-javascript">//
// Variables
//

var myPlugin = {}; // Object for public APIs
var supports = !!document.querySelector &amp;&amp; !!root.addEventListener; // Feature test
var settings; // Placeholder variables

// Default settings
var defaults = {
	someVar: 123,
	initClass: 'js-myplugin',
	callbackBefore: function () {},
	callbackAfter: function () {}
};
</code></pre>

<p><code>myPlugin</code> should be changed to the name of your plugin. Any public methods (ones that can be accessed and used outside of the module wrapper) are added to this object, which is returned at the end of the script. No variables or functions can be accessed or used outside of your plugin unless they&rsquo;re explicitly added to the <code>myPlugin</code> object.</p>

<p>For example, <code>myPlugin.init()</code> will be used to initialize the plugin, and is accessible from other scripts, where as the <code>supports</code> variable cannot be.</p>

<h2 id="event-handler">Event Handler</h2>

<p>I pass any event listeners-clicks, scrolls, window resizing-through my <code>eventHandler</code> method.</p>

<pre><code class="language-lang-javascript">/**
 * Handle events
 * @private
 */
var eventHandler = function (event) {
	// @todo Do something on event
};
</code></pre>

<p>You can put all sorts of login in here. For example, I like to put my click event listeners on the <code>document</code> element, and then check to see if the element that was clicked is one of the ones I care about.</p>

<pre><code class="language-lang-javascript">var eventHandler = function (event) {
	var toggle = buoy.getClosest(event.target, '[data-example]');
	if ( toggle ) {
		// Prevent default click event
		if ( toggle.tagName.toLowerCase() === 'a') {
			event.preventDefault();
		}
		// Run your methods
		myPlugin.someMethod();
	}
};
</code></pre>

<p>If you want can pass all event types into a single handler, and use some logic to determine the course of action based on the event type.</p>

<pre><code class="language-lang-javascript">var eventHandler = function (event) {
	if ( event.type === 'scroll' ) {
		myPlugin.scrollMethod();
	}
	if ( event.type === 'click' ) {
		myPlugin.clickMethod();
	}
};
</code></pre>

<h2 id="destroy-method">Destroy Method</h2>

<p>I like to provide a way to destroy the current initialization of a plugin. This is useful if you need to reinitialize for some reason, or if another script simply needs to halt whatever you&rsquo;ve got going. As always, change <code>myPlugin</code> to the name of your plugin.</p>

<pre><code class="language-lang-javascript">/**
 * Destroy the current initialization.
 * @public
 */
myPlugin.destroy = function () {

	// If plugin isn't already initialized, stop
	if ( !settings ) return;

	// Remove init class for conditional CSS
	document.documentElement.classList.remove( settings.initClass );

	// @todo Undo any other init functions...

	// Remove event listeners
	document.removeEventListener('click', eventHandler, false);

	// Reset variables
	settings = null;

};
</code></pre>

<h2 id="initialize">Initialize</h2>

<p>While I sometimes write scripts that run on page load, I generally prefer a deliberate initialization. This allows developers to pass in their own settings that can override plugin defaults. It also lets developers include the script on every page as part of a concatenate file without actually running it on every page.</p>

<pre><code class="language-lang-javascript">/**
 * Initialize Plugin
 * @public
 * @param {Object} options User settings
 */
myPlugin.init = function ( options ) {

	// feature test
	if ( !supports ) return;

	// Destroy any existing initializations
	myPlugin.destroy();

	// Merge user options with defaults
	settings = buoy.extend( defaults, options || {} );

	// Add class to HTML element to activate conditional CSS
	document.documentElement.classList.add( settings.initClass );

	// @todo Do stuff...

	// Listen for click events
	document.addEventListener('click', eventHandler, false);

};
</code></pre>

<p>First, I run a check to make sure the required web and JavaScript APIs are supported. In my case, <code>document.querySelector</code> and <code>window.addEventListener</code> are the big ones. These are defined in the <code>supports</code> variable at the beginning of the script.</p>

<pre><code class="language-lang-javascript">if ( !supports ) return;
</code></pre>

<p>Then, I destroy any existing initializations of the script to avoid conflicts or duplicate event listeners.</p>

<pre><code class="language-lang-javascript">myPlugin.destroy();
</code></pre>

<p>Next, I merge any user settings with the defaults using the <code>extend</code> method in Buoy.</p>

<pre><code class="language-lang-javascript">settings = buoy.extend( defaults, options || {} );
</code></pre>

<p>A user would pass settings in like so:</p>

<pre><code class="language-lang-javascript">myPlugin.init({
	someVar: 456,
	initClass: 'js-changeme',
})
</code></pre>

<p>I&rsquo;m a huge advocate of progressive enhancement, and I wait until my JavaScript plugin is initialized before using CSS to hide any content. As a result, I add a class to the <code>html</code> element that I can hook onto with my CSS after the script initializes.</p>

<pre><code class="language-lang-javascript">document.documentElement.classList.add( settings.initClass );
</code></pre>

<p>Lastly, I create my event listeners.</p>

<pre><code class="language-lang-javascript">document.addEventListener('click', eventHandler, false);
</code></pre>

<p>Any methods that should run as soon as the plugin initializes should also be called in <code>myPlugin.init()</code>.</p>

<h2 id="return-your-public-methods">Return your public methods</h2>

<p>The last thing in my plugins is a return with the <code>myPlugin</code> object. This let&rsquo;s developers run any of the public methods in the plugin by prefixing them with <code>myPlugin.</code>.</p>

<pre><code class="language-lang-javascript">return myPlugin;
</code></pre>

<h2 id="an-example">An example</h2>

<p>Let&rsquo;s look at a simple example to see how this all works together.</p>

<p>I want to create a plugin called <code>clickMe.js</code> that adds a class to a link when the link is clicked. The class will vary from link to link, and not all links will trigger this behavior. We&rsquo;re going to use the <code>[data-click-me]</code> data attribute to identify links that should trigger the class-adding behavior. We&rsquo;ll also use this attribute to pass in the class that should be added.</p>

<p>When the browser is resized, I want to print a message in the console log. It will be same message every time. Here&rsquo;s how I would write this plugin.</p>

<pre><code class="language-lang-javascript">(function (root, factory) {
	if ( typeof define === 'function' &amp;&amp; define.amd ) {
		define(['buoy'], factory(root));
	} else if ( typeof exports === 'object' ) {
		module.exports = factory(require('buoy'));
	} else {
		root.clickMe = factory(root, root.buoy);
	}
})(typeof global !== 'undefined' ? global : this.window || this.global, function (root) {

	'use strict';

	//
	// Variables
	//

	var clickMe = {}; // Object for public APIs
	var supports = !!document.querySelector &amp;&amp; !!root.addEventListener; // Feature test
	var settings; // Placeholder variables

	// Default settings
	var defaults = {
		resizeLog: 'The window was resized!',
		callbackBefore: function () {},
		callbackAfter: function () {}
	};


	//
	// Methods
	//

	/**
	 * Add a class to a link when it's clicked
	 * @private
	 * @param {Event} event The click event
	 */
	var addClass = function ( event ) {

		// Get the thing that was clicked
		var toggle = event.target;

		// Check if the thing that was clicked has the [data-click-me] attribute
		if ( toggle &amp;&amp; toggle.hasAttribute( 'data-click-me' ) ) {

			// Prevent default click event
			if ( toggle.tagName.toLowerCase() === 'a') {
				event.preventDefault();
			}

			// Set the [data-click-me] value as a class on the link
			toggle.classList.add( toggle.getAttribute( 'data-click-me' ) );

		}

	};

	/**
	 * Handle events
	 * @private
	 */
	var eventHandler = function (event) {

		// Callback before the event handler runs
		settings.callbackBefore;

		// On click
		if ( event.type === 'click' ) {
			addClass( event );
		}

		// On resize
		if ( event.type === 'resize' ) {
			console.log( settings.resizeLog );
		}

		// Callback after the event handler runs
		settings.callbackAfter;

	};

	/**
	 * Destroy the current initialization.
	 * @public
	 */
	clickMe.destroy = function () {

		// If plugin isn't already initialized, stop
		if ( !settings ) return;

		// Remove all added classes
		var links = document.querySelectorAll( '[data-click-me]' );
		for ( var i = 0, len = links.length; i &lt; len; i++  ) {
			links[i].classList.remove( links[i].getAttribute( 'data-click-me' ) );
		}

		// Remove event listeners
		document.removeEventListener('click', eventHandler, false);
		window.removeEventListener('resize', eventHandler, false);

		// Reset variables
		settings = null;

	};

	/**
	 * Initialize Plugin
	 * @public
	 * @param {Object} options User settings
	 */
	clickMe.init = function ( options ) {

		// feature test
		if ( !supports ) return;

		// Destroy any existing initializations
		clickMe.destroy();

		// Merge user options with defaults
		settings = buoy.extend( defaults, options || {} );

		// Listen for click events
		document.addEventListener('click', eventHandler, false);
		window.addEventListener('resize', eventHandler, false);

	};


	//
	// Public APIs
	//

	return clickMe;

});
</code></pre>

</article>

	<br>
<aside>
	<p><mark>üöÄ <em><strong>Make 2018 the year you master JavaScript!</strong> My <a href="https://gomakethings.com/guides/">pocket guides</a> and <a href="https://gomakethings.com/courses/">mini courses</a> are short, focused, and made for beginners. You can do this!</em></mark></p>

	<p><em>Have any questions or comments about this post? Email me at <a href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;">&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;</a> or contact me on Twitter at <a href="http://twitter.com/ChrisFerdinandi">@ChrisFerdinandi</a>.</em></p>

	<form action="https://gomakethings.us1.list-manage.com/subscribe/post?u=f2d244c0df42a0431bd08ddea&amp;id=aeaa9dd034" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank">
	<div class="row">
		<div class="grid-two-thirds">
			<div class="tarpit">
				<label for="name">Don't fill this field in</label>
				<input type="text" name="b_f2d244c0df42a0431bd08ddea_aeaa9dd034" id="name" value="">
			</div>
			<div>
				<label class="screen-reader" for="mce-EMAIL">Email Address</label>
				<input type="email" name="EMAIL" id="mce-EMAIL" title="The domain portion of the email address is invalid (the part after the @)." pattern="^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*(\.\w{2,})+$" placeholder="Your email address..." required>
			</div>
			<input type="hidden" value="16" name="group[6981][16]" id="mce-group[6981]-6981-0">
		</div>
		<div class="grid-third">
			<button class="btn btn-block" type="submit">Get Daily Developer Tips</button>
		</div>
	</div>
	<div class="mc-status"></div>
</form>
</aside>

			</div>
		</main>

		<footer class="container container-large">
			<hr class="margin-bottom">
			<nav class="tabindex nav-secondary" id="nav-secondary" tabindex="-1">
	<ul class="list-inline list-inline-responsive">
		<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
	</ul>
</nav>
			<p class="text-small">Made with ‚ù§Ô∏è in Massachussets. Unless otherwise noted, all code is free to use under the <a href="/mit">MIT License</a>.</p>
		</footer>

		<script src="https://gomakethings.com/js/loadJS.min.1.1.0.js"></script>
		<script>
			if ('querySelector' in document && 'addEventListener' in window) {
				loadJS('https:\/\/gomakethings.com\/js\/main.min.1.1.0.js');
			}
		</script>
	</body>
</html>